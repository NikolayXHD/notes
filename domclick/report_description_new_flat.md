# Модель детекции новостройки в описании вторички

Контактное лицо: Николай Идальго Диас, @nikolayhd, nmidalgodias@domclick.ru
Автор модели: Косакин Даниил Юрьевич, бывший сотрудник, датасаентист команды
Smart Moderation.

## Задача

По тексту описания оффера продажи вторичного жилья, модель должна определить,
что на самом деле оффер является новостройкой.

## Данные

1. Положительные примеры отобраны по признаку причины отклонения на этапе
модерации.

Используются 3 набора данных

1. Dataset для обучения векторизатора текста, description_unlabeled.csv
~20_000 примеров описаний offer-а

Датасет построен из объявлений за период январь -- март 2023г, включительно.
Таблица offers.offers

2. Размеченный dataset для обучения классификатора description_updated.csv

~6_000 положительных примеров (новостройка)
~60_000 отрицательных примеров

Подробностей про подготовку этого датасета не удалось найти.

Разелён на обучающую, валидационную и тестовую выборки в пропорции 80 / 10 / 10

3. Тщательно размеченный датасет для окончательной валидации new_flat_oot.xlsx
~500 наблюдений

40 положительных примеров (новостройка)
460 отрицательных примеров

https://jira.sberned.ru/browse/NUDS-2681

Датасеты в MLECO: http://mleco.stat.sberned.ru/dataset/433
Модель в MLECO: http://mleco.stat.sberned.ru/model/322/evaluation/2

## Модель

Модель состоит из 3х шагов

1. Предобработка текста.
- Заменяем упоминания года в тексте на одну из 3х меток
  "PAST_YEAR", "CURRENT_YEAR", "NEXT_YEAR"
- Сегментация библиотекой natasha
- Лемматизация слов библиотекой pymorphy2

2. Векторизация fastext
- Превращаем слова оффера в эмбеддинги длины 212
- Для эмбеддингов оффера среднее и максимум в пределах предложения
- Конкатенируем вектор средних и вектор максимальных значений

Неясно, почему только максимум, но не миниммум, т.к. числа в эмбеддингах имеют
произвольный знак.

3. Классификация библиотекой xgboost

## Оценка качества

Сигнал от модели увеличивает счётчик подозрительных сигналов, но сам по себе не
используется для бана оффера.

Поэтому, можем себе позволить не фиксировать высокий precision.

Порог классификатора оптимизирует f1 для класса положительных примеров
(новостройки)

Измеренные метрики на датасете для окончательной валидации, new_flat_oot.xlsx

Precision: 0.78
Recall: 0.88
f1: 0.82

## Воспроизведение

Блокноты сохранены в MLECO в артефактах модели.
http://mleco.stat.sberned.ru/model/322/evaluation/2/artifacts

Согласно иструкции о валидации, скопировал блокноты на cpu2
https://jupyterhub-cpu2.sberned.ru/user/nmidalgodias/lab по пути
`/data/validation/description_new_flat`

## Cвязанные репозитории
Чекер: https://bitbucket.sberned.ru/projects/AF/repos/smart_new_flat_checker
Микросервис: https://bitbucket.sberned.ru/projects/AF/repos/smart_moderation_new_flat
Сервис-потребитель: https://bitbucket.sberned.ru/projects/AF/repos/smart_moderation
